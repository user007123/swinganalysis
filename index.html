<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hover Greens Studio — Online Swing Analysis</title>
<style>
  :root{
    --bg:#0b0f14; --fg:#eaf0f6; --muted:#a6b0bd; --brand:#19d47a; --brand-2:#4aa8ff; --panel:#131a22; --border:rgba(255,255,255,.08);
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:
    radial-gradient(1200px 600px at 70% -10%,rgba(25,212,122,.08),transparent),
    radial-gradient(900px 500px at 0% 100%,rgba(74,168,255,.10),transparent), var(--bg);
    color:var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;}
  a{color:var(--brand-2)}
  .wrap{max-width:1200px;margin:0 auto;padding:24px}
  header.hero{
    display:grid; gap:18px; padding:40px 0 20px; align-items:center;
    grid-template-columns: 1.2fr .8fr;
  }
  @media (max-width: 960px){ header.hero{grid-template-columns:1fr; padding-top:24px} }
  .tag{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;
       background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.01)); color:var(--muted); font-weight:700; font-size:12px; letter-spacing:.3px; text-transform:uppercase}
  h1{font-size: clamp(28px, 4.5vw, 46px); line-height:1.1; margin:8px 0}
  .sub{color:var(--muted); font-size:clamp(15px,1.5vw,18px)}
  .cta-row{display:flex;flex-wrap:wrap;gap:12px;margin-top:10px}
  .btn{border:1px solid var(--border); background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.02));
       color:var(--fg); padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer}
  .btn.primary{background:linear-gradient(90deg,var(--brand),var(--brand-2)); border:none}
  .btn.danger{background:linear-gradient(90deg,#ff5964,#ff8c5a); border:none}
  .pill{padding:6px 10px; border:1px solid var(--border); border-radius:999px; background:rgba(255,255,255,.02)}
  .grid{display:grid; gap:16px}
  .panels{display:grid; grid-template-columns:1fr 1fr; gap:16px}
  @media (max-width: 960px){ .panels{grid-template-columns:1fr} }
  .panel{background:var(--panel); border:1px solid var(--border); border-radius:14px; overflow:hidden; position:relative}
  .panel header{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid var(--border); background:rgba(255,255,255,.02)}
  .panel header .ttl{font-weight:800}
  .panel .slot{position:relative; aspect-ratio:16/9; background:#0b0e13}
  video{width:100%; height:100%; object-fit:contain; background:#000}
  canvas.overlay{position:absolute; left:0; top:0; width:100%; height:100%; pointer-events:none}
  .panel footer{padding:10px 12px; border-top:1px solid var(--border); background:rgba(255,255,255,.02)}
  .tools, .global{display:flex; flex-wrap:wrap; gap:8px; align-items:center}
  .tiny{font-size:12px; color:var(--muted)}
  .divider{height:1px; background:var(--border); margin:18px 0}
  input[type="range"]{accent-color:var(--brand-2)}
  select{background:rgba(255,255,255,.03); color:var(--fg); border:1px solid var(--border); border-radius:8px; padding:6px}
  .pulse{position:absolute; right:12px; top:10px; width:10px; height:10px; border-radius:50%; background:var(--brand);
         box-shadow:0 0 0 8px rgba(25,212,122,.12); animation:pulse 2s infinite}
  @keyframes pulse{0%{box-shadow:0 0 0 8px rgba(25,212,122,.12)} 60%{box-shadow:0 0 0 16px rgba(25,212,122,.01)} 100%{box-shadow:0 0 0 8px rgba(25,212,122,.12)}}
  .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#0f1420; border:1px solid var(--border); padding:2px 6px; border-radius:6px}
  .note{color:var(--muted); font-size:13px}
  .floating-help{position:fixed; right:16px; bottom:16px; background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:10px 12px}
</style>
</head>
<body>
  <div class="wrap">
    <header class="hero">
      <div>
        <span class="tag">Hover Greens Studio</span>
        <h1>Touchless, multi-angle golf swing analysis — right in your browser.</h1>
        <p class="sub">Upload or record swings, sync with pro examples, draw and measure, slow it down, and step frame-by-frame. No downloads. No logins.</p>
        <div class="cta-row">
          <button class="btn primary" id="ctaStart">Start Now</button>
          <span class="tiny">Shortcuts: <span class="kbd">Space</span> Play/Pause • <span class="kbd">,</span>/<span class="kbd">.</span> frame step</span>
        </div>
      </div>
      <div class="panel" aria-label="Live preview">
        <header><span class="ttl">Hover Greens Studio</span><span class="tiny">Draw lines • Angle tool • Multi-angle</span></header>
        <div class="slot">
          <video id="previewVideo" muted loop playsinline></video>
          <canvas class="overlay" id="previewOverlay"></canvas>
        </div>
        <footer><div class="tools"><span class="note">Load or record your videos below to begin.</span></div></footer>
      </div>
    </header>

    <section class="panel">
      <header>
        <span class="ttl">Global Controls</span>
        <div class="global">
          <label class="pill">Playback&nbsp;<input id="rate" type="range" min="0.1" max="1.0" step="0.05" value="0.35" /></label>
          <button class="btn" id="btnSync">Play/Pause Both</button>
          <button class="btn" id="btnBack">◀︎ Frame</button>
          <button class="btn" id="btnFwd">Frame ▶︎</button>
          <label class="pill">Draw
            <select id="drawMode">
              <option value="off">Off</option>
              <option value="line">Line</option>
              <option value="angle">Angle (2 lines)</option>
            </select>
          </label>
          <button class="btn" id="btnClear">Clear Drawings</button>
        </div>
      </header>
      <footer><span class="tiny">Playback rate and frame stepping affect all players.</span></footer>
    </section>

    <section class="grid panels" id="panelGrid">
      <!-- Left: Angle A -->
      <div class="panel" data-role="player" id="panelA">
        <header>
          <span class="ttl">Angle A (Your Swing)</span>
          <div class="tools">
            <label class="btn">Upload<input type="file" accept="video/*" hidden class="file"></label>
            <select class="cameraSel" title="Select Camera A"></select>
            <button class="btn" data-cam>Use Camera</button>
            <span class="pill tiny">Playback <span class="rate">1.0x</span></span>
          </div>
        </header>
        <div class="slot">
          <video class="vid" playsinline></video>
          <canvas class="overlay"></canvas>
        </div>
        <footer>
          <div class="tools">
            <div class="group">
              <button class="btn" data-play>Play</button>
              <button class="btn" data-pause>Pause</button>
              <button class="btn" data-back>◀︎ Frame</button>
              <button class="btn" data-fwd>Frame ▶︎</button>
            </div>
            <div class="group">
              <label class="pill">Rate <input type="range" min="0.1" max="1.0" step="0.05" value="0.35" data-rate></label>
              <button class="btn" data-clear>Clear</button>
            </div>
          </div>
        </footer>
      </div>

      <!-- Right: Angle B -->
      <div class="panel" data-role="player" id="panelB">
        <header>
          <span class="ttl">Angle B (Pro/2nd View)</span>
          <div class="tools">
            <label class="btn">Upload<input type="file" accept="video/*" hidden class="file"></label>
            <select class="cameraSel" title="Select Camera B"></select>
            <button class="btn" data-cam>Use Camera</button>
            <span class="pill tiny">Playback <span class="rate">1.0x</span></span>
          </div>
        </header>
        <div class="slot">
          <video class="vid" playsinline></video>
          <canvas class="overlay"></canvas>
        </div>
        <footer>
          <div class="tools">
            <div class="group">
              <button class="btn" data-play>Play</button>
              <button class="btn" data-pause>Pause</button>
              <button class="btn" data-back>◀︎ Frame</button>
              <button class="btn" data-fwd>Frame ▶︎</button>
            </div>
            <div class="group">
              <label class="pill">Rate <input type="range" min="0.1" max="1.0" step="0.05" value="0.35" data-rate></label>
              <button class="btn" data-clear>Clear</button>
            </div>
          </div>
        </footer>
      </div>
    </section>

    <div class="divider"></div>

    <section class="panel">
      <header>
        <span class="ttl">Simultaneous Recording</span>
        <div class="tools">
          <label class="pill"><input type="checkbox" id="autoPlayAfter" checked /> Auto-play after record</label>
          <label class="pill"><input type="checkbox" id="autoLoop" checked /> Loop playback</label>
          <label class="pill">Max Duration (s)
            <input type="number" id="maxDur" min="1" max="120" value="8" style="width:70px;background:transparent;color:var(--fg);border:none;outline:none;text-align:center">
          </label>
          <button class="btn primary" id="recordBoth">● Record Both</button>
          <button class="btn danger" id="stopBoth" disabled>■ Stop</button>
          <span class="tiny" id="recStatus">Not recording</span>
        </div>
      </header>
      <footer class="note">
        Select different cameras in each panel (USB cams show by name). Click <b>● Record Both</b> to capture simultaneously. When it stops, both clips auto-sync and (optionally) auto-play.
      </footer>
    </section>

    <div class="floating-help tiny">Hover Greens Studio — made for fast, visual improvement.</div>
  </div>

<script>
(function(){
  const $ = (sel, el=document)=>el.querySelector(sel);
  const $$ = (sel, el=document)=>[...el.querySelectorAll(sel)];
  const clamp = (v,min,max)=>Math.min(max,Math.max(min,v));

  // --- Decorative overlay in hero
  const previewOverlay = $('#previewOverlay');
  const pctx = previewOverlay.getContext('2d');
  function resizeCanvas(canvas){
    const r = canvas.getBoundingClientRect();
    canvas.width = Math.max(2, Math.floor(r.width));
    canvas.height = Math.max(2, Math.floor(r.height));
  }
  resizeCanvas(previewOverlay);
  let t=0; (function drawPreview(){
    resizeCanvas(previewOverlay);
    pctx.clearRect(0,0,previewOverlay.width, previewOverlay.height);
    pctx.strokeStyle = '#4aa8ff'; pctx.lineWidth = 3;
    const w = previewOverlay.width, h = previewOverlay.height;
    const x = (Math.sin(t/40)*.4+.5)*w*0.9;
    pctx.beginPath(); pctx.moveTo(x, h*.2); pctx.lineTo(x, h*.8); pctx.stroke();
    pctx.fillStyle = 'rgba(25,212,122,.25)';
    pctx.beginPath(); pctx.arc(w*.6, h*.55, 36+6*Math.sin(t/12), 0, Math.PI*2); pctx.fill();
    t++; requestAnimationFrame(drawPreview);
  })();

  // --- Globals
  const globalRate = $('#rate');
  const btnSync = $('#btnSync'), btnBack=$('#btnBack'), btnFwd=$('#btnFwd');
  const drawModeSel = $('#drawMode'), btnClearAll = $('#btnClear');
  const recordBtn = $('#recordBoth'), stopBtn = $('#stopBoth'), recStatus = $('#recStatus');
  const autoPlayAfter = $('#autoPlayAfter'), autoLoop = $('#autoLoop'), maxDur = $('#maxDur');

  const panelGrid = $('#panelGrid');

  function timeStep(video, dir=+1){
    const step = 1/60;
    video.pause();
    video.currentTime = clamp(video.currentTime + dir*step, 0, video.duration || 1e9);
  }

  async function listCameras(){
    try{
      // Trigger permission prompt if not yet granted, so labels are readable
      await navigator.mediaDevices.getUserMedia({video:true, audio:false}).then(s=>s.getTracks().forEach(tr=>tr.stop())).catch(()=>{});
      const devices = await navigator.mediaDevices.enumerateDevices();
      return devices.filter(d=>d.kind==='videoinput');
    }catch(e){ console.warn(e); return []; }
  }

  function populateCameraDropdowns(){
    listCameras().then(cams=>{
      $$('.cameraSel').forEach((sel,i)=>{
        sel.innerHTML = '';
        cams.forEach((c, idx)=>{
          const opt = document.createElement('option');
          opt.value = c.deviceId;
          opt.textContent = c.label || `Camera ${idx+1}`;
          sel.appendChild(opt);
        });
        if(cams.length) sel.value = cams[Math.min(i, cams.length-1)].deviceId;
      });
    });
  }

  // --- Panel init (upload, camera preview, drawing, per-rate, etc.)
  function initPanel(panel){
    const video = $('.vid', panel);
    const overlay = $('.overlay', panel);
    const ctx = overlay.getContext('2d');
    const rateLabel = $('.rate', panel);
    const rateSlider = $('[data-rate]', panel);
    const file = $('.file', panel);
    const btnPlay = $('[data-play]', panel);
    const btnPause = $('[data-pause]', panel);
    const btnBack = $('[data-back]', panel);
    const btnFwd = $('[data-fwd]', panel);
    const btnCam = $('[data-cam]', panel);
    const camSel = $('.cameraSel', panel);

    // Resize overlay
    const ro = new ResizeObserver(()=>resizeCanvas(overlay)); ro.observe(overlay);

    // Upload video
    file?.addEventListener('change', e=>{
      const f = e.target.files[0]; if(!f) return;
      const url = URL.createObjectURL(f);
      video.srcObject = null; video.src = url; video.load();
      if(autoLoop.checked) video.loop = true;
    });

    // Camera preview
    let currentStream = null;
    async function startCam(){
      try{
        const id = camSel?.value;
        const constraints = {video: id ? {deviceId: {exact:id}, width:{ideal:1920}, height:{ideal:1080}} : {width:{ideal:1920},height:{ideal:1080}}, audio:false};
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        if(currentStream) currentStream.getTracks().forEach(t=>t.stop());
        currentStream = stream;
        video.srcObject = stream; video.muted = true; await video.play();
        if(!panel.querySelector('.pulse')) panel.insertAdjacentHTML('beforeend','<span class="pulse" title="Camera live"></span>');
        panel.__player.stream = stream;
      }catch(err){ console.error(err); alert('Camera not available or permission denied.'); }
    }
    btnCam?.addEventListener('click', startCam);

    // Controls
    btnPlay.addEventListener('click', ()=>video.play());
    btnPause.addEventListener('click', ()=>video.pause());
    btnBack.addEventListener('click', ()=>timeStep(video, -1));
    btnFwd.addEventListener('click', ()=>timeStep(video, +1));

    // Per-panel rate
    rateSlider.addEventListener('input', ()=>{
      video.playbackRate = parseFloat(rateSlider.value);
      rateLabel.textContent = video.playbackRate.toFixed(2)+'x';
    });
    const applyGlobalRate = ()=>{ const r = parseFloat(globalRate.value); video.playbackRate = r; rateSlider.value = r; rateLabel.textContent = r.toFixed(2)+'x'; };
    applyGlobalRate();

    // Drawing
    let drawState = { mode:'off', points:[], shapes:[] };
    function px(ev){
      const r = overlay.getBoundingClientRect();
      const x = ( (ev.clientX ?? ev.touches?.[0]?.clientX) - r.left ) / r.width * overlay.width;
      const y = ( (ev.clientY ?? ev.touches?.[0]?.clientY) - r.top ) / r.height * overlay.height;
      return {x,y};
    }
    function redraw(){
      resizeCanvas(overlay);
      ctx.clearRect(0,0,overlay.width,overlay.height);
      ctx.lineWidth = 3; ctx.lineCap='round'; ctx.lineJoin='round';
      for(const s of drawState.shapes){
        if(s.type==='line'){ ctx.strokeStyle = '#4aa8ff'; ctx.beginPath(); ctx.moveTo(s.a.x,s.a.y); ctx.lineTo(s.b.x,s.b.y); ctx.stroke(); }
        if(s.type==='angle'){
          ctx.strokeStyle = '#19d47a';
          ctx.beginPath(); ctx.moveTo(s.b.x,s.b.y); ctx.lineTo(s.a.x,s.a.y); ctx.stroke();
          ctx.beginPath(); ctx.moveTo(s.b.x,s.b.y); ctx.lineTo(s.c.x,s.c.y); ctx.stroke();
          const ang = angleBetween(s.b,s.a,s.c);
          ctx.fillStyle = 'rgba(0,0,0,.6)'; ctx.strokeStyle='rgba(255,255,255,.35)';
          ctx.beginPath(); ctx.arc(s.b.x, s.b.y, 22, 0, Math.PI*2); ctx.fill(); ctx.stroke();
          ctx.fillStyle='#fff'; ctx.font='bold 12px system-ui, sans-serif'; ctx.textAlign='center'; ctx.textBaseline='middle';
          ctx.fillText(`${ang.toFixed(1)}°`, s.b.x, s.b.y);
        }
      }
      if(drawState.points.length){
        ctx.fillStyle='#19d47a';
        for(const p of drawState.points){ ctx.beginPath(); ctx.arc(p.x,p.y,4,0,Math.PI*2); ctx.fill(); }
      }
    }
    function angleBetween(B,A,C){
      const v1={x:A.x-B.x, y:A.y-B.y}, v2={x:C.x-B.x, y:C.y-B.y};
      const dot=v1.x*v2.x+v1.y*v2.y, m1=Math.hypot(v1.x,v1.y), m2=Math.hypot(v2.x,v2.y);
      const cos = clamp(dot/(m1*m2+1e-9), -1, 1); return (Math.acos(cos)*180/Math.PI);
    }
    function onDown(ev){ if(drawState.mode==='off') return; ev.preventDefault();
      const pt=px(ev); drawState.points.push(pt);
      if(drawState.mode==='line' && drawState.points.length===2){ drawState.shapes.push({type:'line', a:drawState.points[0], b:drawState.points[1]}); drawState.points=[]; }
      if(drawState.mode==='angle' && drawState.points.length===3){ const [a,b,c]=drawState.points; drawState.shapes.push({type:'angle', a,b,c}); drawState.points=[]; }
      redraw();
    }
    function onMove(ev){ if(!drawState.points.length) return; const pt=px(ev); drawState.points[drawState.points.length-1]=pt; redraw(); }

    overlay.addEventListener('pointerdown', onDown);
    overlay.addEventListener('pointermove', onMove);
    overlay.addEventListener('touchstart', onDown, {passive:false});
    overlay.addEventListener('touchmove', onMove, {passive:false});

    function clearDraw(){ drawState.points=[]; drawState.shapes=[]; redraw(); }

    // Expose player API
    panel.__player = {
      video, overlay, redraw, clearDraw, stream:null,
      setRate:(r)=>{ video.playbackRate=r; rateSlider.value=r; rateLabel.textContent=r.toFixed(2)+'x'; },
      step:(d)=>timeStep(video,d),
      startCam, camSel
    };

    $('[data-clear]', panel).addEventListener('click', clearDraw);
  }

  // Init both primary panels
  $$('.panel[data-role="player"]').forEach(initPanel);
  populateCameraDropdowns();

  // Global controls
  globalRate.addEventListener('input', ()=>{
    const r = parseFloat(globalRate.value);
    $$('.panel[data-role="player"]').forEach(p=>p.__player?.setRate(r));
  });
  drawModeSel.addEventListener('change', ()=>{
    window.__drawMode = drawModeSel.value;
    window.dispatchEvent(new Event('dm_drawmode'));
  });
  window.__drawMode = drawModeSel.value;
  btnSync.addEventListener('click', ()=>{
    const vids = $$('.panel[data-role="player"] .vid');
    const playAll = vids.some(v=>v.paused);
    vids.forEach(v=> playAll ? v.play() : v.pause());
  });
  btnBack.addEventListener('click', ()=>{$$('.panel[data-role="player"]').forEach(p=>p.__player?.step(-1));});
  btnFwd.addEventListener('click', ()=>{$$('.panel[data-role="player"]').forEach(p=>p.__player?.step(+1));});
  btnClearAll.addEventListener('click', ()=>{$$('.panel[data-role="player"]').forEach(p=>p.__player?.clearDraw());});
  $('#ctaStart').addEventListener('click', ()=>panelGrid.scrollIntoView({behavior:'smooth'}));

  // --- Simultaneous recording (Option A)
  let recA=null, recB=null, chunksA=[], chunksB=[], recTimer=null;
  async function ensurePreviewStreams(){
    const panels = [$('#panelA'), $('#panelB')];
    for(const p of panels){
      if(!p.__player.stream){ await p.__player.startCam(); }
    }
  }
  function makeRecorder(stream, ondata){ 
    const mime = MediaRecorder.isTypeSupported('video/webm;codecs=vp9') ? 'video/webm;codecs=vp9' :
                 MediaRecorder.isTypeSupported('video/webm;codecs=vp8') ? 'video/webm;codecs=vp8' : 'video/webm';
    const rec = new MediaRecorder(stream, {mimeType:mime, videoBitsPerSecond: 6_000_000});
    rec.ondataavailable = e=>{ if(e.data && e.data.size) ondata(e.data); };
    return rec;
  }
  function setRecUI(active){
    recordBtn.disabled = active;
    stopBtn.disabled = !active;
    recStatus.textContent = active ? 'Recording…' : 'Not recording';
  }

  async function startBoth(){
    await ensurePreviewStreams();
    const pA = $('#panelA').__player, pB = $('#panelB').__player;
    chunksA=[]; chunksB=[];
    recA = makeRecorder(pA.stream, d=>chunksA.push(d));
    recB = makeRecorder(pB.stream, d=>chunksB.push(d));
    recA.start(); recB.start();
    setRecUI(true);
    // Auto stop after maxDur seconds (safety)
    const dur = clamp(parseFloat(maxDur.value)||8, 1, 120);
    recTimer = setTimeout(stopBoth, dur*1000);
  }

  function blobToVideo(video, blob){
    const url = URL.createObjectURL(blob);
    video.srcObject = null;
    video.src = url;
    video.loop = autoLoop.checked;
    video.load();
  }

  function syncAndPlay(){
    const vA = $('#panelA').__player.video;
    const vB = $('#panelB').__player.video;
    const startWhenReady = ()=>{
      if(Number.isFinite(vA.duration) && vA.duration>0 && Number.isFinite(vB.duration) && vB.duration>0){
        vA.currentTime = 0; vB.currentTime = 0;
        const r = parseFloat(globalRate.value);
        vA.playbackRate=r; vB.playbackRate=r;
        if(autoPlayAfter.checked){ vA.play(); vB.play(); }
      }else{
        setTimeout(startWhenReady, 60);
      }
    };
    startWhenReady();
  }

  function stopBoth(){
    try{ recA && recA.state!=='inactive' && recA.stop(); }catch{}
    try{ recB && recB.state!=='inactive' && recB.stop(); }catch{}
    clearTimeout(recTimer); recTimer=null;
    setRecUI(false);

    // Once both stop, build blobs and assign
    const done = {};
    const tryFinish = ()=>{
      if(done.a && done.b){
        // assign to videos and sync play
        const vA = $('#panelA').__player.video;
        const vB = $('#panelB').__player.video;
        const blobA = new Blob(chunksA, {type: chunksA[0]?.type || 'video/webm'});
        const blobB = new Blob(chunksB, {type: chunksB[0]?.type || 'video/webm'});
        blobToVideo(vA, blobA);
        blobToVideo(vB, blobB);
        syncAndPlay();
      }
    };
    recA && (recA.onstop = ()=>{ done.a=true; tryFinish(); });
    recB && (recB.onstop = ()=>{ done.b=true; tryFinish(); });
  }

  recordBtn.addEventListener('click', startBoth);
  stopBtn.addEventListener('click', stopBoth);

  // Keyboard shortcuts
  document.addEventListener('keydown', (e)=>{
    if(e.target && ['INPUT','TEXTAREA','SELECT'].includes(e.target.tagName)) return;
    if(e.code==='Space'){ e.preventDefault(); btnSync.click(); }
    if(e.key===',' ){ e.preventDefault(); btnBack.click(); }
    if(e.key==='.' ){ e.preventDefault(); btnFwd.click(); }
  });
})();
</script>
</body>
</html>
